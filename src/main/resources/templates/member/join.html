<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/basic}">
<th:block layout:fragment="content">
  <div class="container-fluid mt-5" th:object="${userTravel}" >
    <div>
      <h2 class="tit text-center mb-4">íšŒì›ê°€ì…</h2>

      <form id="joinForm" th:action="@{/join}" th:method="post" class="box content_box" >

        <table>
          <colgroup>
            <col style="width:100px">
            <col style="width:calc(100% - 100px)">
          </colgroup>
          <tbody>
          <tr>
            <th>
              <label for="userId">
                ì•„ì´ë”” <span class="txt_info ck">*</span>
              </label>
            </th>
            <td>
              <input th:field="*{userId}"  name="userId" id="userId" class="form-control id"
                     th:errorclass="err" type="text" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”.">
            </td>
          </tr>
          <tr>
            <th>ë¹„ë°€ë²ˆí˜¸ <span class="txt_info ck">*</span></th>
            <td>
              <input th:field="*{userPassword}" name="userPassword" id="userPassword" type="password"  class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.">
            </td>
          </tr>
          <tr>
            <th>ì´ë¦„ <span class="txt_info ck">*</span></th>
            <td><input th:field="*{userName}"  name="userName" id="userName" class="form-control" type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”."></td>
          </tr>
          <tr>
            <th>ìƒë…„ì›”ì¼ <span class="txt_info ck">*</span></th>
            <td><input th:field="*{userBirthday}"  name="userBirthday" id="userBirthday" th:errorclass="err" class="form-control" type="text" placeholder="ìƒë…„ì›”ì¼ 6ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”."></td>
          </tr>

          <tr>
            <th>ì´ë©”ì¼ <span class="txt_info ck">*</span></th>
            <td>
              <input th:field="*{userEmail}" name="userEmail" id="userEmail" th:errorclass="err" class="form-control" type="text" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.">
            </td>
          </tr>

          <tr>
            <th>ì—°ë½ì²˜ <span class="txt_info ck">*</span></th>
            <td><input th:field="*{userPhone}" name="userPhone" id="userPhone"   class="form-control" type="text"  placeholder="ì—°ë½ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”. EX) 010-0000-0000"></td>
          </tr>
          <tr>
            <th>ì£¼ì†Œ  <span class="txt_info ck">*</span></th>
            <td class="address_wrap">
              <div class="address_post">
                <input type="text" id="addressPostcode" th:field="*{addressPostcode}" placeholder="ìš°í¸ë²ˆí˜¸" class="form-control">
                <input type="button" onclick="addressPostcodes()" value="ìš°í¸ë²ˆí˜¸ ì°¾ê¸°" class="btn btn-dark btn-sm">
              </div>
              <div class="address_info">
                <input type="text" id="address" th:field="*{address}" placeholder="ì£¼ì†Œ" class="form-control">
              </div>
              <div class="address_detail">
                <input type="text" id="addressDetail" th:field="*{addressDetail}" placeholder="ìƒì„¸ì£¼ì†Œ" class="form-control">
                <input type="text" id="addressExtra" th:field="*{addressExtra}" placeholder="ì°¸ê³ í•­ëª©" class="form-control">
              </div>


            </td>
          </tr>
          <tr>
            <th>ì„±ë³„</th>
            <td>
              <label for="userGenderM">
                <input name="userGender" id="userGenderM" value="userGenderM" type="radio"  th:checked="${userTravel.userGender eq 'userGenderM'}" checked="checked" /> ë‚¨ì„±
              </label>
              <label for="userGenderW" class="ml-2">
                <input  name="userGender" id="userGenderW" value="userGenderW" type="radio" th:checked="${userTravel.userGender eq 'userGenderW'}" /> ì—¬ì„±
              </label>
            </td>
          </tr>
          <tr>
            <th>í”„ë¡œí•„ <br />ì´ë¯¸ì§€</th>
            <td>
              <div class="userimg_wrap">
                <div class="userimg_box">
                  <img id="preview" src="" alt="">
                </div>
                <label for="userImg" class="btn btn-dark btn-sm ">
                  ğŸ‘†í”„ë¡œí•„ ì„ íƒí•˜ê¸°ğŸ‘†
                </label>
                <input type="file" th:field="*{userImg}"  name="userImg" id="userImg" accept="image/*">
              </div>
            </td>
          </tr>
          </tbody>
        </table>

        <label for="userAgree" class="mt-2">
          <input th:field="*{userAgree}" name="userAgree" id="userAgree" type="checkbox"/> ê°œì¸ì •ë³´ ë™ì˜ <span class="txt_info ck">*</span>
        </label>
        <div class="user_agree_wrap mt-2">
          ì—¬í–‰ì§€ ì°¾ê¸°'ë©”ë‰´ ì—ì„œ ëª¨ë‘ì™€ ê³µìœ í•˜ê³  ì†Œí†µí•  ìˆ˜ ìˆì–´ìš”.
        </div>

        <a class="w-100 btn btn-primary mt-4" href="javascript:void(0)" onclick="joinForm()" >ê°€ì…í•˜ê¸°</a>


      </form>
    </div>


    <!-- Modal -->
    <script type="text/javascript" th:if="${#fields.hasErrors()} or *{idCk}">
        $(document).ready(function (){
            $('#modalJoin').modal("show");
        })
    </script>
    <div class="modal fade" id="modalJoin" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="staticBackdropLabel"> íšŒì›ê°€ì… í™•ì¸ </h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p class="modal-message">
              <span th:field="*{idCk}" th:if="*{idCk}" class="err_txt">
              ì•„ì´ë”” ë³€ê²½ : ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë”” ì…ë‹ˆë‹¤.
               </span>
              <br />
              <span th:if="${#fields.hasErrors('userEmail')}" th:errors="*{userEmail}"></span>
              <br />
              <span th:if="${#fields.hasErrors('userBirthday')}" th:errors="*{userBirthday}"></span>
              <br />
              <span th:if="${#fields.hasErrors('userPhone')}" th:errors="*{userPhone}"></span>
              <br />
              <span th:if="${#fields.hasErrors('userName')}" th:errors="*{userName}"></span>
              <br />
              <span th:if="${#fields.hasErrors('userId')}" th:errors="*{userId}"></span>
            </p>
          </div>
        </div>
      </div>
    </div>


  </div>




  <!-- start í”„ë¡œí•„ ì´ë¯¸ì§€ -->
  <script>
      var file = document.querySelector('#userImg');

      file.onchange = function () {
          var fileList = file.files ;

          // ì½ê¸°
          var reader = new FileReader();
          reader.readAsDataURL(fileList [0]);

          //ë¡œë“œ í•œ í›„
          reader.onload = function  () {
              document.querySelector('#preview').src = reader.result ;
          };
      };
  </script>
  <!-- end í”„ë¡œí•„ ì´ë¯¸ì§€ -->

  <!-- start ì£¼ì†Œ íŒì—… -->
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script>
      function addressPostcodes() {
          new daum.Postcode({
              oncomplete: function(data) {
                  // íŒì—…ì—ì„œ ê²€ìƒ‰ê²°ê³¼ í•­ëª©ì„ í´ë¦­í–ˆì„ë•Œ ì‹¤í–‰í•  ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë¶€ë¶„.

                  // ê° ì£¼ì†Œì˜ ë…¸ì¶œ ê·œì¹™ì— ë”°ë¼ ì£¼ì†Œë¥¼ ì¡°í•©í•œë‹¤.
                  // ë‚´ë ¤ì˜¤ëŠ” ë³€ìˆ˜ê°€ ê°’ì´ ì—†ëŠ” ê²½ìš°ì—” ê³µë°±('')ê°’ì„ ê°€ì§€ë¯€ë¡œ, ì´ë¥¼ ì°¸ê³ í•˜ì—¬ ë¶„ê¸° í•œë‹¤.
                  var addr = ''; // ì£¼ì†Œ ë³€ìˆ˜
                  var extraAddr = ''; // ì°¸ê³ í•­ëª© ë³€ìˆ˜

                  //ì‚¬ìš©ìê°€ ì„ íƒí•œ ì£¼ì†Œ íƒ€ì…ì— ë”°ë¼ í•´ë‹¹ ì£¼ì†Œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
                  if (data.userSelectedType === 'R') { // ì‚¬ìš©ìê°€ ë„ë¡œëª… ì£¼ì†Œë¥¼ ì„ íƒí–ˆì„ ê²½ìš°
                      addr = data.roadAddress;
                  } else { // ì‚¬ìš©ìê°€ ì§€ë²ˆ ì£¼ì†Œë¥¼ ì„ íƒí–ˆì„ ê²½ìš°(J)
                      addr = data.jibunAddress;
                  }

                  // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì£¼ì†Œê°€ ë„ë¡œëª… íƒ€ì…ì¼ë•Œ ì°¸ê³ í•­ëª©ì„ ì¡°í•©í•œë‹¤.
                  if(data.userSelectedType === 'R'){
                      // ë²•ì •ë™ëª…ì´ ìˆì„ ê²½ìš° ì¶”ê°€í•œë‹¤. (ë²•ì •ë¦¬ëŠ” ì œì™¸)
                      // ë²•ì •ë™ì˜ ê²½ìš° ë§ˆì§€ë§‰ ë¬¸ìê°€ "ë™/ë¡œ/ê°€"ë¡œ ëë‚œë‹¤.
                      if(data.bname !== '' && /[ë™|ë¡œ|ê°€]$/g.test(data.bname)){
                          extraAddr += data.bname;
                      }
                      // ê±´ë¬¼ëª…ì´ ìˆê³ , ê³µë™ì£¼íƒì¼ ê²½ìš° ì¶”ê°€í•œë‹¤.
                      if(data.buildingName !== '' && data.apartment === 'Y'){
                          extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                      }
                      // í‘œì‹œí•  ì°¸ê³ í•­ëª©ì´ ìˆì„ ê²½ìš°, ê´„í˜¸ê¹Œì§€ ì¶”ê°€í•œ ìµœì¢… ë¬¸ìì—´ì„ ë§Œë“ ë‹¤.
                      if(extraAddr !== ''){
                          extraAddr = ' (' + extraAddr + ')';
                      }
                      // ì¡°í•©ëœ ì°¸ê³ í•­ëª©ì„ í•´ë‹¹ í•„ë“œì— ë„£ëŠ”ë‹¤.
                      document.getElementById("addressExtra").value = extraAddr;

                  } else {
                      document.getElementById("addressExtra").value = '';
                  }

                  // ìš°í¸ë²ˆí˜¸ì™€ ì£¼ì†Œ ì •ë³´ë¥¼ í•´ë‹¹ í•„ë“œì— ë„£ëŠ”ë‹¤.
                  document.getElementById('addressPostcode').value = data.zonecode;
                  document.getElementById("address").value = addr;
                  // ì»¤ì„œë¥¼ ìƒì„¸ì£¼ì†Œ í•„ë“œë¡œ ì´ë™í•œë‹¤.
                  document.getElementById("addressDetail").focus();
              }
          }).open();
      }
  </script>
  <!-- end ì£¼ì†Œ íŒì—… -->

  <!-- start í¼ ì €ì¥ ë° ëª¨ë‹¬ -->
  <script type="text/javascript">
      // ì•„ì´ë”” í™•ì¸

      $(function(){
          $('input.err').on("change",function (){
              $(this).removeClass("err");
              if($('input.err').hasClass("id")){
                  $('.err_txt').hide();
              }
          })

      });

      function joinForm(){
          if(document.getElementById("userId").value==''){
              $('#modalJoin').modal("show");
              $('.modal-message').html('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
              $("#userId").addClass('err');

              return false;
          }
          if(document.getElementById("userPassword").value==''){
              $('#modalJoin').modal("show");
              $('.modal-message').html('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
              $("#userPassword").addClass('err');

              return false;
          }

          if(document.getElementById("userName").value==''){
              $('#modalJoin').modal("show");
              $('.modal-message').html('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
              $("#userName").addClass('err');


              return false;
          }
          if(document.getElementById("userEmail").value==''){
              $('#modalJoin').modal("show");
              $('.modal-message').html('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
              $("#userEmail").addClass('err');
              return false;
          }

          if(document.getElementById("userPhone").value==''){
              $('#modalJoin').modal("show");
              $('.modal-message').html('ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
              $("#userPhone").addClass('err');
              return false;
          }

          if(document.getElementById("address").value==''){
              $('#modalJoin').modal("show");
              $('.modal-message').html('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
              $("#address").addClass('err');
              return false;
          }

          if(document.getElementById("userBirthday").value==''){
              $('#modalJoin').modal("show");
              let html = "<div>ìƒë…„ì›”ì¼ 6ìë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.<div>"
              + "<br>ex. 230423";
              $('.modal-message').html(html);
              $("#userBirthday").addClass('err');
              return false;
          }

          if ( ! $('input[name=userAgree]:checked').val()) {
              alert('ê°œì¸ì •ë³´ í™œìš©ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
              return false;
          }

          document.getElementById('joinForm').submit();
      }
  </script>

  <!-- end í¼ ì €ì¥ ë° ëª¨ë‹¬ -->
</th:block>
</html>

