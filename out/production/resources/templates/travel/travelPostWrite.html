<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/basic}">
<th:block layout:fragment="content">



    <div class="content_nav"  th:object="${category}">
        <!-- start : navbar -->
<!--        <th:block th:replace="layout/navBarTravelView::navBarTravelView"></th:block>-->
        <div class="content">
            <h3 class="tit text-center">글쓰기</h3>
            <form class="mt-2" action="insertStudentInfoForm" method="post" enctype="multipart/form-data">
                <!--start 시큐리티 추가 -->
                <input class="csrf_input" type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <input class="csrf_input" type="hidden" th:name="${_csrf.getHeaderName()}">
                <!--end 시큐리티 추가 -->
                <input id="categoryNoSave"  type="text" th:value="${category.categoryNo}">
                <input id="itemNoSave"  type="text" value="itemNum">
                <table class="board-top">
                    <colgroup>
                        <col style="width:20%">
                        <col style="width:80%">
                    </colgroup>
                    <tbody>
                        <tr>
                            <th>제목</th>
                            <td>
                                <input id="boardTite" class="form-control" type="text">
                            </td>

                        </tr>
                        <tr>
                            <th>여행 일자</th>
                            <td><span class="dayName" th:text="${days.dayInfo[0]}"></span></td>
                        </tr>
                        <tr>
                            <th>썸네일</th>
                            <td><input text=""></td>
                        </tr>
                    </tbody>
                </table>
                <div id="editor_con">
                    <div id="summernote"></div>
                </div>
                <button class="btn btn-primary mt-3 w-100" type="button" onclick="submitPost()">저장하기</button>
            </form>
        </div>
    </div>
    <!-- 페이지 로딩시 초기화 -->



    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function (){
            $("#itemNoSave").val(1);
        });



            $('#summernote').summernote({
                placeholder: '기억에 남는 여행 순간들을 기록해보세요.',
                tabsize: 2,
                height: 300,
                minHeight: null,             // 최소 높이
                maxHeight: null,             // 최대 높이
                focus: true,                  // 에디터 로딩후 포커스를 맞출지 여부
                lang: "ko-KR",					// 한글 설정
                toolbar: [
                    ['style', ['style']],
                    ['font', ['bold', 'underline', 'clear']],
                    ['color', ['color']],
                    ['para', ['ul', 'ol', 'paragraph']],
                    ['table', ['table']],
                    ['insert', ['link', 'picture', 'video']],
                    ['view', ['fullscreen', 'codeview', 'help']]
                ],
                callbacks: {
                    onImageUpload: function (files, editor, welEditable) {
                        // 파일 업로드 (다중 업로드를 위해 반복문 사용)
                        for (var i = files.length - 1; i >= 0; i--) {
                            var fileName = files[i].name

                            // 이미지 alt 속성 삽일을 위한 설정
                            var caption = prompt('이미지 설명 :', fileName)
                            if (caption == '') {
                                caption = '이미지'
                            }
                            uploadSummernoteImageFile(files[i], this, caption)
                        }
                    },
                }

            });


            // 이미지 업로드 함수 ajax 활용
            function uploadSummernoteImageFile(file, el, caption) {
                var headerName = document.getElementsByClassName("csrf_input")[1].getAttribute("name");
                var token = document.getElementsByClassName("csrf_input")[0].getAttribute("value");



                let formData = new FormData();
                formData.append('file', file)
                console.log(formData);
                $.ajax({
                    type: 'post',
                    data: formData,
                    url: "/file/image",
                    dataType: 'json',
                    contentType: false,
                    enctype: 'multipart/form-data',
                    processData: false,
                    async: true, //동기, 비동기 여부
                    cache :false, // 캐시 여부
                    beforeSend : function(xhr)
                    {
                        xhr.setRequestHeader(headerName, token);
                    },
                    focus: true,
                    success: function (img) {
                        console.log(img)
                    },
                    error:function (data){
                        console.log(data)
                    }
                });
                console.log("3")
            }

    </script>
</th:block>
</html>