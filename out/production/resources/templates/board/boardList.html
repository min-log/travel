<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/basic}">
<th:block layout:fragment="content">
  <div class="content_nav">
    <div class="content">
      <h2 class="tit text-center mb-2">ì—¬í–‰ì§€ ëª¨ì•„ëª¨ì•„</h2>
      <p class="text-center mb-5">ê³ ê°ë‹˜ë“¤ì´ ê³µìœ í•´ì£¼ì‹  ì—¬í–‰ì§€ ì •ë³´ì…ë‹ˆë‹¤.</p>
      <div class="board_wrap" th:object="${categoryPage}">
        <div class="board_top mb-2 ">
          <p>
            total <span th:text="${categoryPage.getTotalElements()}">2</span>
          </p>
          <p class="ml-2">
            <select class="form-select form-select-sm" aria-label=".form-select-sm example" onchange="window.open(value,'_self')" >
              <option th:selected="${orderCk} == 'dateStart'" th:value="@{/board/boardList(k = ${param.k},page=${pageing.getPage()},order='dateStart')}" >ì—¬í–‰ ì‹œì‘ì¼</option>
              <option th:selected="${orderCk} == 'createdAt'" th:value="@{/board/boardList(k = ${param.k},page=${pageing.getPage()},order='createdAt')}">ì‘ì„±ì¼</option>
            </select>
          </p>
        </div>
        <th:block th:if="|${categoryPage.getContent().size() <= 0}|">
          <p class="text-center mt-5">
            ğŸ˜­ ì°¾ìœ¼ì‹œëŠ” ì§€ì—­ì˜ ì»¨í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤. ğŸ˜­<br />
            â¤ï¸ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš” â¤ï¸<br /><br />
            <a class="btn btn-outline-secondary" th:href="@{/board/boardList}">ì „ì²´ ëª©ë¡ ë°”ë¡œê°€ê¸°</a>
          </p>
        </th:block>
        <ul class="board_content row row-cols-1 row-cols-md-2 g-4 ">
          <th:block th:each="list,i:${categoryPage.getContent()}">
            <li class="col" th:class="|col col_${list.categoryNo}|" >
              <div class="card">
                <div class="card-body">
                  <p class="img" th:if="${list.boardImg}">
                    <img th:src="${list.boardImg}" alt="ì—¬í–‰ì¸ë‚´ì¼">
                  </p>
                  <div class="con">
                    <p class="address_info mt-1">
                      <a th:href="|javascript:btnLike(${list.categoryNo})|" title="ì°œí•˜ê¸°" class="btn_heart">
                        <i class="bi bi-heart"></i>
                        <th:block th:each="likes,i:${likeList}">
                          <i th:if="${likes.categoryId == list.categoryNo}" class="bi bi-heart-fill"></i>
                        </th:block>
                      </a>
                      <span class="point-color" th:text="${list.categoryArea}">ì œì£¼ë„</span>
                      <th:block th:if="${list.categoryAreaDetails != ''}">
                        / <span class="point-color" th:text="${list.categoryAreaDetails}">ì œì£¼ë„</span>
                      </th:block>
                    </p>
                    <h5 th:text="${list.categoryName}" class="card-title">ë™ë¬¼ë†ì¥ ì—¬í–‰</h5>
                    <div class="mt-1">
                      <span><i class="bi bi-calendar-week"></i> ì¼ì • : [[${list.dateTxt} - 1 ]] ë°• [[${list.dateTxt}]] ì¼</span>
                      <p class="travel_date mt-1" style="display:inline-block">
                        ( <span class="travel_day_start" th:text="${list.dateStart}">2023-08-11</span>
                        -
                        <span class="travel_day_end" th:text="${list.dateEnd}">2023-08-20</span> )
                      </p>
                    </div>
                    <p class="mt-1"><i class="bi bi-clock"></i>
                      ì‘ì„±ì¼ : [[${#temporals.format(list.createdAt,'yyyy-MM-dd')}]]</p>
                    <p class="travel_people mt-1">
                      <i class="bi bi-emoji-smile"></i>
                      <span class="txt_info" style="color: #333">ì‘ì •ì : </span>
                      <span class="tag point" th:text="${list.categoryWriter}"></span>
                      <th:block th:each="tagItem,i:${list.tagList}" th:if="${i.size > 0}" >
                        <span class="">ì¸ì› : </span>
                        <span th:text="${i.size} + 1" class="tag"></span>
                      </th:block>
                    </p>
                  </div>
                </div>
                <!-- end :card-body -->
                <div class="btn-group border-top">
                  <a th:href="@{/travel/view(no=${list.categoryNo})}" class="btn">ì¼ì •ìƒì„¸ <i class="bi bi-map-fill"></i></a>
                  <th:block th:if="${list.boardExistence}">
                    <a th:href="@{/travel/post(no=${list.categoryNo},day=1)}" class="btn">ì—¬í–‰ê¸°ë¡ <i class="bi bi-pen-fill"></i></a>
                  </th:block>
                </div>
              </div>
            </li>
          </th:block>
        </ul>
        <div th:object="${pageing}" class="mt-5 text-center">
            <th:block th:if="${pageing.prev}">
              <a class="btn btn-outline-secondary" th:href="@{/board/boardList(k = ${param.k},page = ${pageing.start - 5})}" tabindex="-1"> < </a>
            </th:block>
            <th:block th:each="page : ${pageing.pageList}">
              <a  th:href="@{/board/boardList(k = ${param.k},page = ${page})}" th:text="${page}" class="btn btn-outline-secondary"  th:class="'btn btn-outline-secondary '+${pageing.page == page ? 'active':''}"    ></a>
            </th:block>
            <th:block th:if="${pageing.next}">
              <a class="btn btn-outline-secondary" th:href="@{/board/boardList(k = ${param.k},page = ${pageing.end + 1})}" tabindex="-1"> > </a>
            </th:block>
        </div>
      </div>


    </div>
  </div>


  <script type="text/javascript">
      function btnLike(e){
          console.log(e);
          let box = ".col_"+e;
          let con='';
          $.ajax({
              url:'/board/likeSave?no=' + e,
              type: 'get',
              success:function (data){
                  console.log(data);
                  if (data == 1){
                      con = '<div class="text-center">ê²Œì‹œê¸€ì´ ì°œë¦¬ìŠ¤íŠ¸ì— ì €ì¥ ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
                      con += '<div><a class="btn btn-primary w-100 btn-sm mt-3" href="/mypage/boardLikeList" >ì°œë¦¬ìŠ¤íŠ¸ ë°”ë¡œê°€ê¸°</a></div>';
                      $("#modalMsg").modal("show");
                      $("#modalMsg .modal-message").html(con);
                      $(box).find(".btn_heart .bi").removeClass("bi-heart");
                      $(box).find(".btn_heart .bi").addClass("bi-heart-fill");
                  }else if (data == 0){
                      con = '<div class="text-center">ê²Œì‹œê¸€ ì €ì¥ì„ ì‚­ì œ í–ˆìŠµë‹ˆë‹¤.</div>';
                      $("#modalMsg").modal("show");
                      $("#modalMsg .modal-message").html(con);

                      $(box).find(".btn_heart .bi").removeClass("bi-heart-fill");
                      $(box).find(".btn_heart .bi").addClass("bi-heart");

                  }else {
                      con = '<div class="text-center"><p class="point-color tit mb-2">Travel Road</p>ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤. </div>';
                      con += '<div><a class="btn btn-primary w-100 btn-sm mt-5" href="/loginForm" >ë¡œê·¸ì¸í•˜ê¸°</a></div>';
                      $('#modalMsg').modal("show");
                      $('#modalMsg .modal-message').html(con);

                     // alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.");
                  }
              },
              error:function (){
                  alert("ì €ì¥ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.")
              }

          })
      }
  </script>

  <script type="text/javascript">
    $(document).ready(function (){

        let today = new Date();
        console.log("today : "+today);

        $(".board_content li").each(function (index, item) {
           let startDay = $(this).find(".travel_day_start").text();
           let startEnd = $(this).find(".travel_day_end").text();
           console.log("startDay : "+ startDay);
            startDay = new Date(startDay);
            startEnd = new Date(startEnd);
            var total = startEnd - startDay;
            var perc = today - startDay;



            const totalDay = Math.floor(total / (1000*60*60*24));
            const totalHour = Math.floor((total / (1000*60*60)) % 24);
            const totalMin = Math.floor((total / (1000*60)) % 60);
            const totalSec = Math.floor(total / 1000 % 60);
            console.log(  index+" - totalDay ) "+ totalDay+"ì¼ "+ totalHour+"ì‹œê°„ " +totalMin +"ë¶„ " +totalSec+"ì´ˆ");

            const diffDay = Math.floor(perc / (1000*60*60*24));
            const diffHour = Math.floor((perc / (1000*60*60)) % 24);
            const diffMin = Math.floor((perc / (1000*60)) % 60);
            const diffSec = Math.floor(perc / 1000 % 60);
            console.log( index+") "+ diffDay+"ì¼ "+ diffHour+"ì‹œê°„ " +diffMin +"ë¶„ " +diffSec+"ì´ˆ");


            console.log("startDay" + startDay);
            console.log("startEnd" + startEnd);


            console.log(index  + "ê·¸ë˜ì„œ... : " + (totalDay-diffDay)*0.01);
            console.log(index  + "ê·¸ë˜ì„œ... : " + (totalDay-diffDay) + "%");



            console.log("************************");
            console.log("************************");
            console.log("************************");
            console.log("************************");
            console.log("************************");



        });

    });
  </script>

</th:block>
</html>

